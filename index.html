<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>8‑Week Patellar Tendon Rehab Planner</title>
  <meta name="description" content="Daily checkbox planner for 8‑week patellar tendinopathy rehab with upper‑body/core on non‑HSR days. Local save, print, and export/import." />
  <style>
    :root {
      --bg: #0b0c10;
      --panel: #12141a;
      --card: #171a21;
      --ink: #e6e7eb;
      --muted: #a9afbf;
      --accent: #6ea8fe;
      --accent-2: #4ade80;
      --warn: #fbbf24;
      --danger: #f87171;
      --border: #242a36;
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: linear-gradient(160deg, var(--bg), #0e1117 45%, #0b0c10);
      color: var(--ink);
      line-height: 1.45;
    }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 24px; }
    header { position: sticky; top: 0; z-index: 20; backdrop-filter: blur(6px); background: rgba(11,12,16,0.7); border-bottom: 1px solid var(--border); }
    header .inner { max-width: 1100px; margin: 0 auto; padding: 12px 24px; display: grid; grid-template-columns: 1fr auto auto; gap: 12px; align-items: center; }
    h1 { font-size: 1.5rem; margin: 0; }
    .subtitle { color: var(--muted); font-size: .95rem; }
    .controls { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
    .controls input[type="date"] { background: var(--card); color: var(--ink); border: 1px solid var(--border); border-radius: 8px; padding: 8px 10px; }
    .btn { background: var(--card); color: var(--ink); border: 1px solid var(--border); padding: 8px 12px; border-radius: 10px; cursor: pointer; }
    .btn:hover { border-color: var(--accent); }
    .btn.primary { background: linear-gradient(180deg, #223554, #1a2a43); border-color: #294268; }
    .btn.accent { background: linear-gradient(180deg, #164e22, #0f3a19); border-color: #1e6a31; }

    .notice { margin: 16px 0; padding: 12px 14px; border: 1px dashed var(--border); border-radius: 10px; background: var(--panel); color: var(--muted); }

    .grid { display: grid; gap: 16px; }
    @media (min-width: 880px) { .grid { grid-template-columns: repeat(2, 1fr); } }

    .week { border: 1px solid var(--border); border-radius: 16px; background: var(--panel); overflow: hidden; }
    .week header.weekhead { padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; background: #0f1218; border-bottom: 1px solid var(--border); }
    .week h2 { margin: 0; font-size: 1.1rem; }
    .week-tools { display: flex; gap: 8px; align-items: center; }
    .visa { color: var(--muted); font-size: .9rem; }
    .visa input { width: 64px; background: var(--card); color: var(--ink); border: 1px solid var(--border); border-radius: 6px; padding: 4px 6px; }

    details.day { border-top: 1px solid var(--border); background: var(--card); }
    details.day[open] summary { background: #141925; }
    summary { list-style: none; display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 12px; padding: 12px 16px; cursor: pointer; }
    summary::-webkit-details-marker { display: none; }
    .date { color: var(--muted); font-size: .9rem; }
    .focus { color: var(--accent-2); font-weight: 600; }

    .content { padding: 12px 16px 18px; display: grid; gap: 10px; }
    .taskline { display: flex; align-items: start; gap: 10px; }
    .taskline input[type="checkbox"] { width: 18px; height: 18px; accent-color: var(--accent-2); }
    .taskline label { user-select: none; }
    .muted { color: var(--muted); }
    .small { font-size: .9rem; }

    .textarea { width: 100%; min-height: 64px; background: var(--panel); color: var(--ink); border: 1px solid var(--border); border-radius: 10px; padding: 8px 10px; }
    .numbers { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
    .numbers label { display: flex; gap: 6px; align-items: center; }
    .numbers input { width: 56px; background: var(--panel); color: var(--ink); border: 1px solid var(--border); border-radius: 6px; padding: 4px 6px; }

    .footer { margin-top: 32px; color: var(--muted); font-size: .9rem; }

    .kicker { display: inline-flex; gap: 6px; align-items: center; padding: 2px 8px; border: 1px solid var(--border); border-radius: 999px; color: var(--muted); font-size: .8rem; }

    @media print {
      header, .footer, .notice, .week-tools button, .controls { display: none !important; }
      body { background: white; color: #111; }
      .week, .day, .content, .textarea { border-color: #bbb !important; color: #111; }
    }
  </style>
</head>
<body>
  <header>
    <div class="inner">
      <div>
        <h1>8‑Week Patellar Tendon Rehab Planner</h1>
        <div class="subtitle">Daily checklist with autosave (local only). Adjust start date to regenerate dates.</div>
      </div>
      <div class="controls">
        <label class="kicker">Start date <input id="startDate" type="date"></label>
        <button class="btn" id="expandAll">Expand all</button>
        <button class="btn" id="collapseAll">Collapse all</button>
        <button class="btn" id="resetProgress" title="Clears all saved checkboxes & notes">Reset</button>
        <button class="btn" id="exportBtn" title="Download your progress as JSON">Export</button>
        <input type="file" id="importFile" accept="application/json" style="display:none" />
        <button class="btn" id="importBtn" title="Import a previously exported JSON">Import</button>
        <button class="btn primary" onclick="window.print()">Print</button>
      </div>
    </div>
  </header>

  <div class="wrap">
    <div class="notice small">
      Pain rule: keep ≤ <strong>3/10</strong> during; symptoms return to baseline within <strong>24 h</strong>. If not, reduce load/volume or repeat a prior day. Use isometric holds for pain relief (5×45–60 s Spanish squat or ~60° leg‑extension hold @ ~70% effort).
    </div>

    <div id="weeks" class="grid" aria-live="polite"></div>

    <div class="footer">
      This is a client‑side static page. Data is stored in your browser’s localStorage under the selected start‑date key. No tracking.
    </div>
  </div>

<script>
(function(){
  const weeksRoot = document.getElementById('weeks');
  const startDateInput = document.getElementById('startDate');
  const expandAllBtn = document.getElementById('expandAll');
  const collapseAllBtn = document.getElementById('collapseAll');
  const resetBtn = document.getElementById('resetProgress');
  const exportBtn = document.getElementById('exportBtn');
  const importBtn = document.getElementById('importBtn');
  const importFile = document.getElementById('importFile');

  // Default start date: today, but if this repo mirrors the prior plan, prefill Oct 29, 2025
  const defaultISO = new Date().toISOString().slice(0,10);
  startDateInput.value = defaultISO;

  startDateInput.addEventListener('change', render);
  expandAllBtn.addEventListener('click', () => toggleAll(true));
  collapseAllBtn.addEventListener('click', () => toggleAll(false));
  resetBtn.addEventListener('click', resetAll);
  exportBtn.addEventListener('click', exportProgress);
  importBtn.addEventListener('click', () => importFile.click());
  importFile.addEventListener('change', onImportFile);

  function storageKey(){ return `rehab-plan-${startDateInput.value}`; }

  function saveProgress(progress){ localStorage.setItem(storageKey(), JSON.stringify(progress)); }
  function loadProgress(){ try { return JSON.parse(localStorage.getItem(storageKey())) || {}; } catch(e){ return {}; } }

  function toggleAll(open){
    document.querySelectorAll('details.day').forEach(d => d.open = open);
  }

  function resetAll(){
    if(!confirm('Clear all saved checkboxes and notes for this start date?')) return;
    localStorage.removeItem(storageKey());
    render();
  }

  function exportProgress(){
    const data = localStorage.getItem(storageKey()) || '{}';
    const blob = new Blob([data], {type: 'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = storageKey() + '.json';
    a.click();
  }

  function onImportFile(e){
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      try {
        const obj = JSON.parse(reader.result);
        if(typeof obj !== 'object') throw new Error('Invalid JSON');
        localStorage.setItem(storageKey(), JSON.stringify(obj));
        render();
      } catch(err) { alert('Import failed: ' + err.message); }
    };
    reader.readAsText(file);
  }

  // —— Plan logic ——
  const UB_A = {
    title: 'Upper Body & Core A (full)',
    text: 'Bench press or push‑ups 4×6–10; 1‑arm DB row 4×8–12/side; Half‑kneeling DB OH press 3×8–10/side; Lat pulldown or assisted pull‑ups 3×6–10; Core: Dead bug 3×8/side, Pallof press 3×10/side, Side plank 3×30–45s/side; Face pulls 2×15; Band ER 2×15.'
  };
  const UB_B = {
    title: 'Upper Body & Core B (full)',
    text: 'Incline DB press 3×8–12; Chest‑supported row 3×8–12; Landmine/Seated DB press 3×8–10; Cable row 3×10–12; Core: RKC plank 3×20–30s, Anti‑rotation walkouts 3×8/side, Farmer carry 3×30–45s; Reverse fly / Y‑T‑W 2×12–15.'
  };
  const UB_SHORT = {
    title: 'Short Upper Body & Core',
    text: 'Push‑ups 2×AMRAP‑2; Band rows 2×15; Half‑kneeling press 2×12/side; Pallof press 2×12/side; Side plank 2×30–45s/side.'
  };

  function HSR(week){
    switch(week){
      case 1: return 'HSR W1: Leg press 4×15 (3‑0‑3), Goblet box squat 3×15, Hip thrust/bridge 3×12–15, Calf raises (straight & bent) 3×15 each, Miniband lateral walks 2×15 m.';
      case 2: return 'HSR W2: Decline squat (bodyweight) 4×15 (3‑0‑3); Leg press 4×15 ↑load; Split squat 3×12/side; Hip thrust 3×12–15; Calf raises 3×15.';
      case 3: return 'HSR W3: Decline squat (eccentric‑biased) 4×12 (5s down / 1s up); Single‑leg leg press 4×12; Reverse lunge 3×10/side; Romanian deadlift 3×10.';
      case 4: return 'HSR W4: Decline squat 4×10 (heavier); Single‑leg leg press 4×10; Step‑downs (15–20 cm) 3×10/side; Hip thrust 3×8–10; Calves heavy 4×10–12.';
      case 5: return 'HSR W5: Decline squat 4×8 (heavy); Hack or Front squat 3×6–8; Leg extension (30–70° ROM) 3×10–12 (slow); RDL 3×8–10; Calves heavy 4×8–10.';
      case 6: return 'HSR W6: Maintain W5 loads — Decline squat 4×8; Hack/Front squat 3×6–8; Leg extension 3×10–12; RDL 3×8–10; Calves heavy 4×8–10.';
      case 7: return 'HSR W7 (strength): Decline squat 4×6–8 (heavy); Hack/Front squat 3×5–6; Single‑leg press 3×8–10; Leg extension 3×8–10; RDL 3×6–8; Calves heavy 4×6–8.';
      case 8: return 'HSR W8 (taper/power): Decline squat 3×5 (moderate, fast concentric); Hack/Front squat 3×5; Leg extension 2–3×6–8; RDL 2–3×5–6; Calves 3×6–8.';
      default: return '';
    }
  }

  function planFor(week, dow){ // dow: 0 Mon .. 6 Sun
    const warmup = {key:'warmup', label:'Warm‑up 8–10 min easy bike/row + dynamic legs/hips/ankles'};
    const iso = {key:'isometrics', label:'Isometrics 5×45–60 s Spanish squat or ~60° leg‑extension @ ~70%'};
    const mobility = {key:'mobility', label:'Mobility: quads/hip‑flexors/calves 30s×2; ankle dorsiflexion rocks 2×10'};

    function pack(focus, segments){
      return { focus, segments };
    }

    // Weeks 1–2
    if([1,2].includes(week)){
      if([0,2,4].includes(dow)) return pack('HSR', [warmup, iso, {key:'main', label: HSR(week)}, mobility]);
      if(dow===1) return pack('Cross‑train + UB/Core A', [warmup, iso, {key:'main', label:'Z2 bike/row 20–30 min'}, {key:'ub', label: UB_A.title, details: UB_A.text}, mobility]);
      if(dow===3) return pack('Cross‑train + UB/Core B', [warmup, iso, {key:'main', label:'Z2 20–30 min'}, {key:'ub', label: UB_B.title, details: UB_B.text}, mobility]);
      if(dow===5) return pack('Mobility + short UB/Core', [iso, {key:'main', label:'Mobility circuit 15–20 min + optional brisk walk 30–45 min'}, {key:'ub', label: UB_SHORT.title, details: UB_SHORT.text}]);
      return pack('Rest', [{key:'rest', label:'Rest'}, {key:'optIso', label:'Optional light isometrics if sore'}, mobility]);
    }

    // Week 3
    if(week===3){
      if([0,2,4].includes(dow)) return pack('HSR', [warmup, iso, {key:'main', label: HSR(3)}, mobility]);
      if(dow===1) return pack('Plyo prep + UB/Core A', [warmup, iso, {key:'plyo', label:'Plyo prep: pogo hops 2×20, marching A‑skips 2×20 m (low amplitude)'}, {key:'ub', label: UB_A.title, details: UB_A.text}, mobility]);
      if(dow===3) return pack('Cross‑train + UB/Core B', [warmup, iso, {key:'main', label:'Z2 20–30 min'}, {key:'ub', label: UB_B.title, details: UB_B.text}, mobility]);
      if(dow===5) return pack('Plyo prep + short UB/Core', [warmup, iso, {key:'plyo', label:'Plyo prep: pogo hops 2×20, marching A‑skips 2×20 m'}, {key:'ub', label: UB_SHORT.title, details: UB_SHORT.text}, mobility]);
      return pack('Rest', [{key:'rest', label:'Rest'}, {key:'optIso', label:'Optional light isometrics if sore'}, mobility]);
    }

    // Week 4
    if(week===4){
      if([0,2,4].includes(dow)) return pack('HSR', [warmup, iso, {key:'main', label: HSR(4)}, mobility]);
      if(dow===1) return pack('Run‑walk + Plyo + UB/Core B', [warmup, iso, {key:'run', label:'Run‑walk 1′/1′ ×10 (easy)'}, {key:'plyo', label:'Line hops 3×20; box landings 3×6 (15–20 cm)'}, {key:'ub', label: UB_B.title, details: UB_B.text}, mobility]);
      if(dow===3) return pack('Cross‑train + UB/Core A', [warmup, iso, {key:'main', label:'Z2 20–30 min'}, {key:'ub', label: UB_A.title, details: UB_A.text}, mobility]);
      if(dow===5) return pack('Run‑walk + Skills + short UB/Core', [warmup, iso, {key:'run', label:'Run‑walk 1′/1′ ×10'}, {key:'skills', label:'Ball skills ≤60% effort 10–15 min'}, {key:'ub', label: UB_SHORT.title, details: UB_SHORT.text}, mobility]);
      return pack('Rest', [{key:'rest', label:'Rest'}, {key:'optIso', label:'Optional light isometrics if sore'}, mobility]);
    }

    // Week 5
    if(week===5){
      if([0,2,4].includes(dow)) return pack('HSR', [warmup, iso, {key:'main', label: HSR(5)}, mobility]);
      if(dow===1) return pack('Run + Plyo/COD + UB/Core A', [warmup, iso, {key:'run', label:'Run 2′/1′ ×8–10 (24–30 min)'}, {key:'plyo', label:'DL jumps 3×10; lateral bounds 3×8/side; decel drills 3×5'}, {key:'ub', label: UB_A.title, details: UB_A.text}, mobility]);
      if(dow===3) return pack('Mobility + UB/Core B', [iso, {key:'main', label:'Mobility only 15–20 min'}, {key:'ub', label: UB_B.title, details: UB_B.text}]);
      if(dow===5) return pack('Plyo/COD + Skills + short UB/Core', [warmup, iso, {key:'plyo', label:'DL jumps 3×10; lateral bounds 3×10/side; shuttle cuts 4×10–15 m'}, {key:'skills', label:'Skills ≤60% 15–20 min'}, {key:'ub', label: UB_SHORT.title, details: UB_SHORT.text}, mobility]);
      return pack('Rest', [{key:'rest', label:'Rest'}, {key:'optIso', label:'Optional light isometrics if sore'}, mobility]);
    }

    // Week 6
    if(week===6){
      if([0,2,4].includes(dow)) return pack('HSR', [warmup, iso, {key:'main', label: HSR(6)}, mobility]);
      if(dow===1) return pack('Run + Plyo/COD + UB/Core B', [warmup, iso, {key:'run', label:'Run 20–30 min easy OR 3′/1′ ×8–10'}, {key:'plyo', label:'Approach jumps 3×8; lateral bounds 3×10/side; shuttle cuts 4×10–15 m @ 70–80%'}, {key:'ub', label: UB_B.title, details: UB_B.text}, mobility]);
      if(dow===3) return pack('Easy cardio + UB/Core A', [warmup, iso, {key:'main', label:'Easy cross‑train 20–25 min OR run‑walk 1′/1′ ×8'}, {key:'ub', label: UB_A.title, details: UB_A.text}, mobility]);
      if(dow===5) return pack('Limited practice + short UB/Core', [warmup, iso, {key:'skills', label:'Limited practice ≤70% for 10–15 min (half‑court hoops or light soccer rondos)'}, {key:'plyo', label:'Plyo/COD as tolerated'}, {key:'ub', label: UB_SHORT.title, details: UB_SHORT.text}, mobility]);
      return pack('Rest', [{key:'rest', label:'Rest'}, {key:'optIso', label:'Optional light isometrics if sore'}, mobility]);
    }

    // Week 7
    if(week===7){
      if([0,2,4].includes(dow)) return pack('HSR (strength)', [warmup, iso, {key:'main', label: HSR(7)}, mobility]);
      if(dow===1) return pack('Run + strides + Plyo + UB/Core A', [warmup, iso, {key:'run', label:'Run 30–35 min easy + 6×20 m strides (walk back)'}, {key:'plyo', label:'Depth landings 20–25 cm 3×5 (quiet)'}, {key:'ub', label: UB_A.title, details: UB_A.text}, mobility]);
      if(dow===3) return pack('Cardio/Tempo + UB/Core B', [warmup, iso, {key:'main', label:'Z2 25–35 min OR tempo 3×6 min @ Z3 (2 min easy)'}, {key:'ub', label: UB_B.title, details: UB_B.text}, mobility]);
      if(dow===5) return pack('COD + Scrimmage + short UB/Core', [warmup, iso, {key:'plyo', label:'Shuttle cuts 5×10–15 m; lateral bounds 3×12/side'}, {key:'skills', label:'Limited scrimmage 15–20 min @ 75–85%'}, {key:'ub', label: UB_SHORT.title, details: UB_SHORT.text}, mobility]);
      return pack('Rest', [{key:'rest', label:'Rest'}, {key:'optIso', label:'Optional light isometrics if sore'}, mobility]);
    }

    // Week 8
    if(week===8){
      if(dow===0) return pack('HSR (power)', [warmup, iso, {key:'main', label: HSR(8) + ' Emphasize fast but controlled concentric; leave ~2 reps in reserve.'}, mobility]);
      if(dow===1) return pack('Intervals + low Plyo + UB/Core B', [warmup, iso, {key:'run', label:'Intervals: 6×2 min @ 80–85% (1 min easy)'}, {key:'plyo', label:'Line hops 2×20; approach jumps 2×6 (low volume)'}, {key:'ub', label: UB_B.title, details: UB_B.text}, mobility]);
      if(dow===2) return pack('Recovery + UB/Core A', [warmup, iso, {key:'main', label:'Recovery: easy 15–20 min cardio + mobility focus'}, {key:'ub', label: UB_A.title, details: UB_A.text}]);
      if(dow===3) return pack('HSR maintainers', [warmup, iso, {key:'main', label:'Key lifts 3×5 (moderate); stop well before pain'}, mobility]);
      if(dow===4) return pack('Prep/Mobility', [iso, {key:'main', label:'Mobility 20 min; optional 4×20 m relaxed strides'}]);
      if(dow===5) return pack('RTP checks + limited practice', [
        {key:'rtp', label:'RTP checks: single‑leg decline squat ≤2/10 pain w/o 24 h flare; 10 single‑leg hops quiet/symmetric; 20–30 min easy continuous run OR 30 min skills ≤75%.'}
      ]);
      return pack('Rest', [{key:'rest', label:'Rest'}]);
    }

    return { focus: '', segments: [] };
  }

  function fmtDate(d){ return d.toISOString().slice(0,10); }
  function addDays(date, days){ const d = new Date(date); d.setDate(d.getDate()+days); return d; }

  function render(){
    weeksRoot.innerHTML = '';
    const startISO = startDateInput.value || new Date().toISOString().slice(0,10);
    const start = new Date(startISO + 'T00:00:00');
    const store = loadProgress();

    for(let w=1; w<=8; w++){
      const weekEl = document.createElement('section');
      weekEl.className = 'week';

      // Week header
      const head = document.createElement('header');
      head.className = 'weekhead';
      const firstDay = addDays(start, (w-1)*7);
      const lastDay = addDays(start, (w-1)*7 + 6);
      const range = `${fmtDate(firstDay)} → ${fmtDate(lastDay)}`;

      head.innerHTML = `<h2>Week ${w} <span class="kicker">${range}</span></h2>` +
        `<div class="week-tools">`+
          `<label class="visa">VISA‑P: <input type="number" min="0" max="100" step="1" data-visa="${w}"></label>`+
        `</div>`;

      weekEl.appendChild(head);

      // Days
      for(let d=0; d<7; d++){
        const dayIndex = (w-1)*7 + d;
        const date = addDays(start, dayIndex);
        const dow = date.getDay(); // 0 Sun..6 Sat
        // Map to 0=Mon..6=Sun
        const dowMon0 = (dow+6)%7;
        const plan = planFor(w, dowMon0);
        const dateKey = fmtDate(date);
        const dayKey = `w${w}-d${d}-${dateKey}`;

        const details = document.createElement('details');
        details.className = 'day';
        details.open = (w<=2 && d<2); // open first couple by default

        const summary = document.createElement('summary');
        const dayName = date.toLocaleDateString(undefined, { weekday: 'short' });
        summary.innerHTML = `<div><strong>${dayName}</strong> <span class="date">${dateKey}</span> — <span class="focus">${plan.focus}</span></div><div class="muted small">click to expand</div>`;
        details.appendChild(summary);

        const content = document.createElement('div');
        content.className = 'content';

        // Segments (checkboxes)
        const saved = store[dayKey] || {};

        plan.segments.forEach((seg, idx) => {
          const line = document.createElement('div');
          line.className = 'taskline';
          const id = `${dayKey}-s${idx}`;
          const cb = document.createElement('input');
          cb.type = 'checkbox';
          cb.id = id;
          cb.checked = !!saved[id];
          cb.addEventListener('change', () => { store[dayKey] = store[dayKey]||{}; store[dayKey][id] = cb.checked; saveProgress(store); });

          const label = document.createElement('label');
          label.setAttribute('for', id);
          label.innerHTML = `<strong>${seg.label}</strong>${seg.details ? `<div class="muted small">${seg.details}</div>`: ''}`;

          line.appendChild(cb);
          line.appendChild(label);
          content.appendChild(line);
        });

        // Pain inputs + notes
        const nums = document.createElement('div');
        nums.className = 'numbers';
        const duringId = `${dayKey}-painDuring`;
        const nextId = `${dayKey}-painNext`;  
        nums.innerHTML = `
          <label>Peak pain during (0–10) <input type="number" min="0" max="10" step="1" id="${duringId}"></label>
          <label>Next‑day pain (0–10) <input type="number" min="0" max="10" step="1" id="${nextId}"></label>
        `;
        content.appendChild(nums);

        const duringInput = () => document.getElementById(duringId);
        const nextInput = () => document.getElementById(nextId);
        // Restore numbers
        if(saved[duringId] != null) setTimeout(()=> duringInput().value = saved[duringId], 0);
        if(saved[nextId] != null) setTimeout(()=> nextInput().value = saved[nextId], 0);
        // Save on change
        const saveNum = () => {
          store[dayKey] = store[dayKey]||{};
          store[dayKey][duringId] = Number(duringInput().value);
          store[dayKey][nextId] = Number(nextInput().value);
          saveProgress(store);
        };
        setTimeout(()=>{
          duringInput().addEventListener('change', saveNum);
          nextInput().addEventListener('change', saveNum);
        }, 0);

        const notesId = `${dayKey}-notes`;
        const notes = document.createElement('textarea');
        notes.className = 'textarea';
        notes.placeholder = 'Notes, loads, reps, regressions/progressions…';
        notes.id = notesId;
        if(saved[notesId]) notes.value = saved[notesId];
        notes.addEventListener('input', () => { store[dayKey] = store[dayKey]||{}; store[dayKey][notesId] = notes.value; saveProgress(store); });
        content.appendChild(notes);

        details.appendChild(content);
        weekEl.appendChild(details);

        // VISA‑P binding for the week header
        const visaInput = head.querySelector(`input[data-visa="${w}"]`);
        const visaKey = `w${w}-visap`;
        if(store[visaKey] != null) visaInput.value = store[visaKey];
        visaInput.addEventListener('change', () => { store[visaKey] = Number(visaInput.value); saveProgress(store); });
      }

      weeksRoot.appendChild(weekEl);
    }
  }

  // Initial render
  render();
})();
</script>
</body>
</html>

